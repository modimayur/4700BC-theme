(function() {
    function Marquee(element, options) {
        this.element = element;
        this.options = Object.assign({
            speed: 10000,
            gap: 20,
            delayBeforeStart: 1000,
            direction: "left",
            postAnimationPause: 0
        }, options);

        this.init();
    }

    Marquee.prototype.init = function() {
        var self = this;

        this.element.style.whiteSpace = "nowrap";
        this.element.style.overflow = "hidden";
        this.element.style.position = "relative";

        this.marqueeInner = document.createElement("div");
        this.marqueeInner.style.display = "inline-block";
        this.marqueeInner.style.marginRight = this.options.gap + "px";
        this.marqueeInner.style.float = "left";
        this.marqueeInner.innerHTML = this.element.innerHTML;

        this.marqueeWrapper = document.createElement("div");
        this.marqueeWrapper.style.width = "100000px";
        this.marqueeWrapper.style.display = "inline-block";
        this.marqueeWrapper.appendChild(this.marqueeInner);
        this.marqueeWrapper.appendChild(this.marqueeInner.cloneNode(true));

        this.element.innerHTML = "";
        this.element.appendChild(this.marqueeWrapper);

        this.marqueeInnerWidth = this.marqueeInner.offsetWidth + this.options.gap;
        this.start();
    };

    Marquee.prototype.start = function() {
        var self = this;

        setTimeout(function() {
            self.animate();
        }, this.options.delayBeforeStart);
    };

    Marquee.prototype.animate = function() {
        var self = this;
        var initialPosition = this.options.direction === "left" ? 0 : -this.marqueeInnerWidth;
        var finalPosition = this.options.direction === "left" ? -this.marqueeInnerWidth : 0;

        this.marqueeWrapper.style.transition = `margin-left ${this.options.speed / 1000}s linear`;
        this.marqueeWrapper.style.marginLeft = finalPosition + "px";

        this.marqueeWrapper.addEventListener('transitionend', function() {
            self.marqueeWrapper.style.transition = "none";
            self.marqueeWrapper.style.marginLeft = initialPosition + "px";

            setTimeout(function() {
                self.animate();
            }, self.options.postAnimationPause);
        }, { once: true });
    };

    Marquee.prototype.reset = function() {
        this.stop();
        this.start();
    };

    Marquee.prototype.stop = function() {
        this.marqueeWrapper.style.transition = "none";
        this.marqueeWrapper.style.marginLeft = this.options.direction === "left" ? 0 : -this.marqueeInnerWidth + "px";
    };

    Marquee.prototype.revert = function() {
        this.options.direction = this.options.direction === "left" ? "right" : "left";
        this.stop();
        this.start();
    };

    // Export the Marquee function to the global scope
    window.Marquee = Marquee;
})();

